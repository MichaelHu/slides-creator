define(["require","zepto","rocket","rocket-ppt","cover-loading"],function(e,t,n,a,i){function o(e){var t,n=location.search,a=new RegExp(e+"=([^&]+)");return(t=n.match(a))?decodeURIComponent(t[1]):null}function r(){t("#cover-loading").animate({opacity:0},1e3,"ease-in",function(){t(this).hide()})}function d(e){e&&e.images?s(e.images,function(){r()}):r(),c(e)}function c(e){var i=null,i=JSON.parse(unescape(i)),o=e||i||{order:["index"],views:{index:{"class":"PlainPageView",html:'<div class="slide"></div>'}},isRelease:!1},r=n.Router.extend({routes:{"*anything":"_defaultHandler:index"},pageOrder:o.order,templateName:o.template||g,isRelease:o.isRelease,editMode:o.editMode||"FULLEDIT",defaultPageTransition:"slideTB",isAllPagesOpened:function(){for(var e=this,t=e.views,n=e.pageOrder,a=0;a<n.length;a++)if(!t[n[a]])return!1;
return!0}}),d=new r;t.each(o.views,function(e,n){var i=t(n.html).appendTo("#wrapper").hide();d.addRoute(e,"_defaultHandler:"+e),d.registerViewClass(e,a[n["class"]].extend({el:i[0],isSetup:!0}))}),"RELEASE"!=d.editMode&&new a.PanelGlobalView(null,d),"PARTIALEDIT"==d.editMode&&u(),window.appRouter=d,"RELEASE"==d.editMode&&(location.href="#"),d.start(),f({act:"2015postcard",act_data_1:d.editMode,act_data_2:d.templateName})}function s(e,t){if(!e||!e.length)return void(t&&t());var n,a=e.length,o=0,r=0;
for(i(30);a>o;)n=new Image,n.src=e[o++],n.onload=n.onabort=n.onerror=function(){r++,i(Math.ceil(70*r/a+30)),r>=a&&setTimeout(function(){t&&t()},100)}}function u(){h.show()}function l(){h.hide()}function p(e,n){setTimeout(function(){var a=t('<link rel="stylesheet" />');t("head").append(a),a.attr("href",[e+(e.indexOf("?")>=0?"":"?")+t.param(n),(new Date).getTime()].join("&")),setTimeout(function(){a.remove()},5e3)},0)}function f(e,n){var a,i="http://nsclick.baidu.com/v.gif";a=t.extend({pid:107,wise:1,from:"topic"},e),n?p(i,a):setTimeout(function(){p(i,a)
},100)}var g="default";o("cardid")?t.ajax({dataType:"jsonp",url:global_greetingcard_server,data:{action:"get",cardid:o("cardid"),x:o("cut_x")||0,y:o("cut_y")||0,w:o("cut_w")||640,h:o("cut_h")||400,ratio:1,detail:1},timeout:5e3,success:function(e){var t;e&&e.data&&e.data.content&&(g=e.data.template||g,t=JSON.parse(unescape(e.data.content)),d(t))},error:function(){console.log(arguments)}}):d();var h=t('<div class="operation-tip"></div>').appendTo("body").hide();h.on("click",function(){l()}),window.specialEncode=function(e){return e.replace(/[\w\W]/g,function(e){return e.charCodeAt(0)>255||"%"==e?escape(e):e
})}});