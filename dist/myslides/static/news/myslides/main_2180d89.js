define(["require","zepto","rocket","rocket-ppt","cover-loading"],function(e,n,t,a,i){function o(e){var n,t=location.search,a=new RegExp(e+"=([^&]+)");return(n=t.match(a))?decodeURIComponent(n[1]):null}function r(){n("#cover-loading").animate({opacity:0},1e3,"ease-in",function(){n(this).hide()})}function d(e){e&&e.images?s(e.images,function(){r()}):r(),c(e)}function c(e){var i=null,i=JSON.parse(unescape(i)),o=e||i||{order:["index"],views:{index:{"class":"PlainPageView",html:'<div class="slide"></div>'}},isRelease:!1},r=t.Router.extend({routes:{"*anything":"_defaultHandler:index"},pageOrder:o.order,isRelease:o.isRelease,editMode:o.editMode||"FULLEDIT",defaultPageTransition:"slideTB"}),d=new r;
n.each(o.views,function(e,t){var i=n(t.html).appendTo("#wrapper").hide();d.addRoute(e,"_defaultHandler:"+e),d.registerViewClass(e,a[t["class"]].extend({el:i[0],isSetup:!0}))}),"RELEASE"!=d.editMode&&new a.PanelGlobalView(null,d),window.appRouter=d,d.start()}function s(e,n){if(!e||!e.length)return void(n&&n());var t,a=e.length,o=0,r=0;for(i(30);a>o;)t=new Image,t.src=e[o++],t.onload=t.onabort=t.onerror=function(){r++,i(Math.ceil(70*r/a+30)),r>=a&&setTimeout(function(){n&&n()},100)}}o("cardid")?n.ajax({dataType:"jsonp",url:global_greetingcard_server,data:{action:"get",cardid:o("cardid"),x:o("cut_x")||0,y:o("cut_y")||0,w:o("cut_w")||640,h:o("cut_h")||400,maxwidth:1e3,ratio:1,detail:1},timeout:5e3,success:function(e){var n;
e&&e.data&&e.data.content&&(n=JSON.parse(unescape(e.data.content)),d(n))},error:function(){console.log(arguments)}}):d()});