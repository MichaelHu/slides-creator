define(["require","zepto","rocket","rocket-ppt","cover-loading"],function(e,n,t,a,i){function r(e){var n,t=location.search,a=new RegExp(e+"=([^&]+)");return(n=t.match(a))?decodeURIComponent(n[1]):null}function o(){n("#cover-loading").animate({opacity:0},1e3,"ease-in",function(){n(this).hide()})}function d(e){e&&e.images?s(e.images,function(){o()}):o(),c(e)}function c(e){var i=null,i=JSON.parse(unescape(i)),r=e||i||{order:["index"],views:{index:{"class":"PlainPageView",html:'<div class="slide"></div>'}},isRelease:!1},o=t.Router.extend({routes:{"*anything":"_defaultHandler:index"},pageOrder:r.order,isRelease:r.isRelease,editMode:r.editMode||"FULLEDIT",defaultPageTransition:"slideTB",isAllPagesOpened:function(){for(var e=this,n=e.views,t=e.pageOrder,a=0;a<t.length;a++)if(!n[t[a]])return!1;
return!0}}),d=new o;n.each(r.views,function(e,t){var i=n(t.html).appendTo("#wrapper").hide();d.addRoute(e,"_defaultHandler:"+e),d.registerViewClass(e,a[t["class"]].extend({el:i[0],isSetup:!0}))}),"RELEASE"!=d.editMode&&new a.PanelGlobalView(null,d),window.appRouter=d,d.start()}function s(e,n){if(!e||!e.length)return void(n&&n());var t,a=e.length,r=0,o=0;for(i(30);a>r;)t=new Image,t.src=e[r++],t.onload=t.onabort=t.onerror=function(){o++,i(Math.ceil(70*o/a+30)),o>=a&&setTimeout(function(){n&&n()},100)
}}r("cardid")?n.ajax({dataType:"jsonp",url:global_greetingcard_server,data:{action:"get",cardid:r("cardid"),x:r("cut_x")||0,y:r("cut_y")||0,w:r("cut_w")||640,h:r("cut_h")||400,maxwidth:1e3,ratio:1,detail:1},timeout:5e3,success:function(e){var n;e&&e.data&&e.data.content&&(n=JSON.parse(unescape(e.data.content)),d(n))},error:function(){console.log(arguments)}}):d()});